<!DOCTYPE html>
<html lang="英语">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transaction | With notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Record learning">
    
    <link rel="preload" href="/assets/css/0.styles.86229549.css" as="style"><link rel="preload" href="/assets/js/app.a84a5bc4.js" as="script"><link rel="preload" href="/assets/js/2.cf7b150b.js" as="script"><link rel="preload" href="/assets/js/1.e8a8831c.js" as="script"><link rel="preload" href="/assets/js/32.ac7ef8ec.js" as="script"><link rel="preload" href="/assets/js/19.5d8b9af5.js" as="script"><link rel="prefetch" href="/assets/js/10.5bfd5340.js"><link rel="prefetch" href="/assets/js/11.61983d84.js"><link rel="prefetch" href="/assets/js/12.05c2fbb5.js"><link rel="prefetch" href="/assets/js/13.055f7ef0.js"><link rel="prefetch" href="/assets/js/14.b5308c17.js"><link rel="prefetch" href="/assets/js/15.5fd21bc7.js"><link rel="prefetch" href="/assets/js/16.6f53edfd.js"><link rel="prefetch" href="/assets/js/17.7d777ab5.js"><link rel="prefetch" href="/assets/js/18.e676ab4a.js"><link rel="prefetch" href="/assets/js/20.cdcc4be3.js"><link rel="prefetch" href="/assets/js/21.69333edc.js"><link rel="prefetch" href="/assets/js/22.289b20fc.js"><link rel="prefetch" href="/assets/js/23.af2243ab.js"><link rel="prefetch" href="/assets/js/24.588f552f.js"><link rel="prefetch" href="/assets/js/25.4522f3a7.js"><link rel="prefetch" href="/assets/js/26.6cdbb216.js"><link rel="prefetch" href="/assets/js/27.d2137ba1.js"><link rel="prefetch" href="/assets/js/28.da06b5d1.js"><link rel="prefetch" href="/assets/js/29.e4202f72.js"><link rel="prefetch" href="/assets/js/3.1bda5a3b.js"><link rel="prefetch" href="/assets/js/30.16ce7af7.js"><link rel="prefetch" href="/assets/js/31.0886b7ee.js"><link rel="prefetch" href="/assets/js/33.e9201557.js"><link rel="prefetch" href="/assets/js/34.57dc5ba5.js"><link rel="prefetch" href="/assets/js/35.d8a2cb5d.js"><link rel="prefetch" href="/assets/js/36.1c982d8a.js"><link rel="prefetch" href="/assets/js/37.cf4359ce.js"><link rel="prefetch" href="/assets/js/38.8631c89b.js"><link rel="prefetch" href="/assets/js/39.d7679381.js"><link rel="prefetch" href="/assets/js/4.9e01a26f.js"><link rel="prefetch" href="/assets/js/40.4b310e42.js"><link rel="prefetch" href="/assets/js/41.a5fbdafd.js"><link rel="prefetch" href="/assets/js/42.f6b5d4df.js"><link rel="prefetch" href="/assets/js/43.222df8b3.js"><link rel="prefetch" href="/assets/js/44.9b46d5ac.js"><link rel="prefetch" href="/assets/js/45.fcefdf0b.js"><link rel="prefetch" href="/assets/js/46.28e7b3cb.js"><link rel="prefetch" href="/assets/js/47.efcb8fb7.js"><link rel="prefetch" href="/assets/js/48.580164b2.js"><link rel="prefetch" href="/assets/js/49.a24614cf.js"><link rel="prefetch" href="/assets/js/5.24725efe.js"><link rel="prefetch" href="/assets/js/50.f6a5e2e3.js"><link rel="prefetch" href="/assets/js/51.a4056af7.js"><link rel="prefetch" href="/assets/js/52.ce027b31.js"><link rel="prefetch" href="/assets/js/53.a1e62627.js"><link rel="prefetch" href="/assets/js/54.e4bf60bb.js"><link rel="prefetch" href="/assets/js/55.d25a581b.js"><link rel="prefetch" href="/assets/js/56.99dff7de.js"><link rel="prefetch" href="/assets/js/57.3a7e915a.js"><link rel="prefetch" href="/assets/js/58.d3d6fbc9.js"><link rel="prefetch" href="/assets/js/59.8ff818f2.js"><link rel="prefetch" href="/assets/js/6.67c595f8.js"><link rel="prefetch" href="/assets/js/60.6c71888b.js"><link rel="prefetch" href="/assets/js/61.30b321ca.js"><link rel="prefetch" href="/assets/js/7.3f39289d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4dff5a50.js">
    <link rel="stylesheet" href="/assets/css/0.styles.86229549.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/note.png" alt="With notes" class="logo"> <span class="site-name can-hide">With notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="front" class="dropdown-title"><span class="title">front</span> <span class="arrow down"></span></button> <button type="button" aria-label="front" class="mobile-dropdown-title"><span class="title">front</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front/base/HTML/frist.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/front/base/CSS/frist.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/front/base/Javascript/frist.html" class="nav-link">
  Javascript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="back" class="dropdown-title"><span class="title">back</span> <span class="arrow down"></span></button> <button type="button" aria-label="back" class="mobile-dropdown-title"><span class="title">back</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back/dataprocessing/frist.html" class="nav-link">
  Data Processing
</a></li><li class="dropdown-item"><!----> <a href="/back/JAVA/frist.html" class="nav-link">
  JAVA
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="database" class="dropdown-title"><span class="title">database</span> <span class="arrow down"></span></button> <button type="button" aria-label="database" class="mobile-dropdown-title"><span class="title">database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/coursenotes/gettingstarted.html" class="nav-link">
  Getting Started
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/databaseoperations.html" class="nav-link">
  Database,Table Operations
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/dataoperations.html" class="nav-link">
  Data Operations
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/multitableoperations.html" class="nav-link">
  Multi-Table Operations
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/transactions.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Transactions
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/views.html" class="nav-link">
  Views
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/indexes.html" class="nav-link">
  Indexes
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  tools
</a></div><div class="nav-item"><a href="/study/" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  about
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/coursenotes/transactions.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  英语
</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">
  中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="front" class="dropdown-title"><span class="title">front</span> <span class="arrow down"></span></button> <button type="button" aria-label="front" class="mobile-dropdown-title"><span class="title">front</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front/base/HTML/frist.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/front/base/CSS/frist.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/front/base/Javascript/frist.html" class="nav-link">
  Javascript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="back" class="dropdown-title"><span class="title">back</span> <span class="arrow down"></span></button> <button type="button" aria-label="back" class="mobile-dropdown-title"><span class="title">back</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back/dataprocessing/frist.html" class="nav-link">
  Data Processing
</a></li><li class="dropdown-item"><!----> <a href="/back/JAVA/frist.html" class="nav-link">
  JAVA
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="database" class="dropdown-title"><span class="title">database</span> <span class="arrow down"></span></button> <button type="button" aria-label="database" class="mobile-dropdown-title"><span class="title">database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/coursenotes/gettingstarted.html" class="nav-link">
  Getting Started
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/databaseoperations.html" class="nav-link">
  Database,Table Operations
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/dataoperations.html" class="nav-link">
  Data Operations
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/multitableoperations.html" class="nav-link">
  Multi-Table Operations
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/transactions.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Transactions
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/views.html" class="nav-link">
  Views
</a></li><li class="dropdown-item"><!----> <a href="/database/coursenotes/indexes.html" class="nav-link">
  Indexes
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  tools
</a></div><div class="nav-item"><a href="/study/" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  about
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/coursenotes/transactions.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  英语
</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">
  中文
</a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="transaction"><a href="#transaction" class="header-anchor">#</a> Transaction</h1> <p>A MySQL transaction is a process that guarantees the integrity of a series of database operations (such as updates, deletions, etc.) in a single unit of work. If any of these steps fails, the entire operation can be rolled back to ensure database consistency.</p> <p>Properties: ACID, atomicity, consistency, isolation, durability</p> <h3 id="a"><a href="#a" class="header-anchor">#</a> A</h3> <p>Atomicity means that a transaction must be treated as an indivisible minimum unit of work, and the entire transaction is successful only if all database operations in the transaction have been successfully executed. If any SQL statement fails to be executed in a transaction, the SQL statements that have been successfully executed must also be rolled back.</p> <h3 id="c"><a href="#c" class="header-anchor">#</a> C</h3> <p>Consistency means that a transaction can only change the database state from one consistent state to another. Consistency in MySQL is mainly achieved by the logging mechanism, which logs all changes to the database and provides a trace record for transaction recovery.</p> <h3 id="i"><a href="#i" class="header-anchor">#</a> I</h3> <p>Isolation means that a transaction is executed without being affected by other transactions. Isolation ensures that all operations of an unfinished transaction are isolated from the database system, and the results of the execution of the transaction cannot be seen until the transaction is completed.</p> <h3 id="d"><a href="#d" class="header-anchor">#</a> D</h3> <p>Persistence means that once a transaction is committed, its modifications to the data in the database are permanent. The persistence of a transaction is not 100% durable, it can only be guaranteed from the perspective of the transaction itself, and if some external cause (such as hard disk corruption) causes a database failure, all the committed data may be lost.</p> <h2 id="opening-of-the-transaction"><a href="#opening-of-the-transaction" class="header-anchor">#</a> Opening of the transaction</h2> <p>By default, each SQL statement executed by the user is automatically committed as a separate transaction. If you want to treat a set of SQL statements as a transaction, you need to explicitly open the transaction.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="transaction-submission"><a href="#transaction-submission" class="header-anchor">#</a> Transaction submission</h2> <p>After a transaction is explicitly enabled, each SQL statement is not automatically submitted. Instead, you need to manually submit the SQL statement. The operations in the SQL statement take effect only after the transaction is submitted.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="transaction-rollback"><a href="#transaction-rollback" class="header-anchor">#</a> Transaction rollback</h3> <p>If you do not want to commit the current transaction, you can cancel the transaction (that is, roll it back).</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="tip"><a href="#tip" class="header-anchor">#</a> Tip</h3> <hr> <p>Precautions when using transactions:
** The ROLLBACK statement can only roll back uncommitted transactions. ** Committed transactions cannot be rolled back.
** When a COMMIT statement or ROLLBACK statement is executed, the current transaction will automatically end **. ** If no transaction is committed until the end of the MySQL session after a transaction is started, the transaction is automatically rolled back. **.
** Transactions are not allowed to be nested **. If the previous TRANSACTION has not been committed before the START TRANSACTION statement is executed, executing the START TRANSACTION statement implicitly executes the commit operation of the previous transaction.
Transactions are mainly for data in data tables, excluding operations such as creating or deleting databases, data tables, and modifying table structures, and implicitly committing transactions when performing such operations.
**InnoDB storage engine supports transactions **, **MyISAM storage engine does not support transactions **. MyISAM stores the data table of the engine, and operations on the data take effect immediately, regardless of whether the transaction is committed or not, and cannot be rolled back.
START a TRANSACTION explicitly using the alias BEGIN or BEGIN WORK for START TRANSACTION. Since BEGIN and BEGIN in stored procedures... END conflicts, therefore ** Use of BEGIN is not recommended. **.</p> <hr> <h3 id="automatic-submission-of-things"><a href="#automatic-submission-of-things" class="header-anchor">#</a> Automatic submission of things</h3> <p>Each SQL statement executed by the user is automatically committed as a separate transaction.
If automatic commit of a transaction is turned off, the transaction can only be committed manually by changing the value of AUTOCOMMIT to set how the transaction is committed.
** The value of AUTOCOMMIT is set to 1 to enable automatic transaction commit, and 0 to disable automatic transaction commit. **.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">View</span> the AUTOCOMMIT <span class="token keyword">value</span> <span class="token keyword">for</span> the <span class="token keyword">current</span> <span class="token keyword">session</span>:

<span class="token keyword">SELECT</span> @<span class="token variable">@AUTOCOMMIT</span><span class="token punctuation">;</span>

Turn <span class="token keyword">off</span> automatic <span class="token keyword">transaction</span> <span class="token keyword">commit</span> <span class="token keyword">for</span> the <span class="token keyword">current</span> <span class="token keyword">session</span>:

<span class="token keyword">SET</span> AUTOCOMMIT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- After shutdown, you need to manually commit the transaction. If no transaction is committed, terminate the MySQL session directly.</span>
<span class="token operator">-</span> <span class="token keyword">Transactions</span> are automatically rolled back<span class="token punctuation">.</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="holding-point-of-the-transaction"><a href="#holding-point-of-the-transaction" class="header-anchor">#</a> holding point of the transaction</h3> <p>After a transaction is rolled back, all operations within the transaction will be undone. If you want to undo only a portion of the operations within the transaction, you can set a save point in the transaction.
After you set the savepoint, you can roll back the transaction to the specified savepoint. If you no longer need a save point, you can delete it.</p> <p>** Statement to set a savepoint in a transaction **</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SAVEPOINT</span> saves the roll <span class="token keyword">call</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>** Statement to roll back the transaction to the save point ** :</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> <span class="token keyword">SAVEPOINT</span> <span class="token keyword">Save</span> the roll <span class="token keyword">call</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Delete save point statement</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">RELEASE</span> <span class="token keyword">SAVEPOINT</span> <span class="token keyword">Save</span> the roll <span class="token keyword">call</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="tip-2"><a href="#tip-2" class="header-anchor">#</a> Tip</h3> <hr> <p>Multiple savepoints can be created in a transaction, and the savepoints in the transaction are deleted after the transaction is committed.
When you roll back to a savepoint, savepoints created after that savepoint are also deleted.</p> <hr></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.a84a5bc4.js" defer></script><script src="/assets/js/2.cf7b150b.js" defer></script><script src="/assets/js/1.e8a8831c.js" defer></script><script src="/assets/js/32.ac7ef8ec.js" defer></script><script src="/assets/js/19.5d8b9af5.js" defer></script>
  </body>
</html>
